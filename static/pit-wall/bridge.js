import*as e from"./tslib.js";var t={};Object.defineProperty(t,"__esModule",{value:true});t.BridgeAPIError=void 0;class BridgeAPIError extends Error{}t.BridgeAPIError=BridgeAPIError;var o={};Object.defineProperty(o,"__esModule",{value:true});o.getCallBridge=void 0;const r=t;function isBridgeAvailable(e){return!!(e===null||e===void 0?void 0:e.callBridge)}const getCallBridge=()=>{if(!isBridgeAvailable(window.__bridge))throw new r.BridgeAPIError("\n      Unable to establish a connection with the Custom UI bridge.\n      If you are trying to run your app locally, Forge apps only work in the context of Atlassian products. Refer to https://go.atlassian.com/forge-tunneling-with-custom-ui for how to tunnel when using a local development server.\n    ");return window.__bridge.callBridge};o.getCallBridge=getCallBridge;var n=e;try{"default"in e&&(n=e.default)}catch(e){}var i={};Object.defineProperty(i,"__esModule",{value:true});i.withRateLimiter=void 0;const s=n;const a=t;const withRateLimiter=(e,t,o,r)=>{let n=Date.now();let i=0;return(...l)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=Date.now();const c=s-n;if(c>o){n=s;i=0}if(i>=t)throw new a.BridgeAPIError(r||"Too many invocations.");i+=1;return e(...l)}))};i.withRateLimiter=withRateLimiter;var l={};Object.defineProperty(l,"__esModule",{value:true});l.invoke=void 0;const c=o;const d=t;const u=i;const v=(0,c.getCallBridge)();const validatePayload$1=e=>{if(e&&Object.values(e).some((e=>typeof e==="function")))throw new d.BridgeAPIError("Passing functions as part of the payload is not supported!")};const _invoke=(e,t)=>{if(typeof e!=="string")throw new d.BridgeAPIError("functionKey must be a string!");validatePayload$1(t);return v("invoke",{functionKey:e,payload:t})};l.invoke=(0,u.withRateLimiter)(_invoke,500,25e3,"Resolver calls are rate limited at 500req/25s");var f=e;try{"default"in e&&(f=e.default)}catch(e){}var _={};Object.defineProperty(_,"__esModule",{value:true});const h=f;h.__exportStar(l,_);var y=e;try{"default"in e&&(y=e.default)}catch(e){}var p={};Object.defineProperty(p,"__esModule",{value:true});p.invokeRemote=void 0;const b=y;const g=o;const w=t;const m=i;const O=500;const P=25e3;const B=(0,g.getCallBridge)();const validatePayload=e=>{if(e&&Object.values(e).some((e=>typeof e==="function")))throw new w.BridgeAPIError("Passing functions as part of the payload is not supported!")};const _invokeRemote=e=>b.__awaiter(void 0,void 0,void 0,(function*(){var t;validatePayload(e);const{success:o,payload:r,error:n}=(t=yield B("invoke",e))!==null&&t!==void 0?t:{};const i=Object.assign({},o?r:n);if(i&&i.headers)for(const e in i.headers)Array.isArray(i.headers[e])&&(i.headers[e]=i.headers[e].join(","));return i}));p.invokeRemote=(0,m.withRateLimiter)(_invokeRemote,O,P,"Remote invocation calls are rate limited at 500req/25s");var j=e;try{"default"in e&&(j=e.default)}catch(e){}var M={};Object.defineProperty(M,"__esModule",{value:true});const C=j;C.__exportStar(p,M);var A=e;try{"default"in e&&(A=e.default)}catch(e){}var x={};Object.defineProperty(x,"__esModule",{value:true});x.submit=void 0;const k=A;const E=o;const q=t;const I=(0,E.getCallBridge)();const submit=e=>k.__awaiter(void 0,void 0,void 0,(function*(){const t=yield I("submit",e);if(t===false)throw new q.BridgeAPIError("this resource's view is not submittable.")}));x.submit=submit;var F=e;try{"default"in e&&(F=e.default)}catch(e){}var R={};Object.defineProperty(R,"__esModule",{value:true});R.close=void 0;const S=F;const T=o;const D=t;const H=(0,T.getCallBridge)();const close=e=>S.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield H("close",e);if(t===false)throw new D.BridgeAPIError("this resource's view is not closable.")}catch(e){throw new D.BridgeAPIError("this resource's view is not closable.")}}));R.close=close;var J=e;try{"default"in e&&(J=e.default)}catch(e){}var U={};Object.defineProperty(U,"__esModule",{value:true});U.refresh=void 0;const L=J;const z=o;const K=t;const N=(0,z.getCallBridge)();const refresh=e=>L.__awaiter(void 0,void 0,void 0,(function*(){const t=yield N("refresh",e);if(t===false)throw new K.BridgeAPIError("this resource's view is not refreshable.")}));U.refresh=refresh;var X=e;try{"default"in e&&(X=e.default)}catch(e){}var G={};Object.defineProperty(G,"__esModule",{value:true});G.createHistory=void 0;const Q=X;const V=o;const W=(0,V.getCallBridge)();const createHistory=()=>Q.__awaiter(void 0,void 0,void 0,(function*(){const e=yield W("createHistory");e.listen((t=>{e.location=t}));return e}));G.createHistory=createHistory;var Y={};Object.defineProperty(Y,"__esModule",{value:true});Y.getContext=void 0;const Z=o;const $=(0,Z.getCallBridge)();const getContext=()=>$("getContext");Y.getContext=getContext;var ee={};Object.defineProperty(ee,"__esModule",{value:true});ee.theme=void 0;const te=o;const oe=(0,te.getCallBridge)();ee.theme={enable:()=>oe("enableTheming")};var re={};Object.defineProperty(re,"__esModule",{value:true});re.view=void 0;const ne=x;const ie=R;const se=U;const ae=G;const le=Y;const ce=ee;re.view={submit:ne.submit,close:ie.close,refresh:se.refresh,createHistory:ae.createHistory,getContext:le.getContext,theme:ce.theme};var de=e;try{"default"in e&&(de=e.default)}catch(e){}var ue={};Object.defineProperty(ue,"__esModule",{value:true});const ve=de;ve.__exportStar(re,ue);var fe=e;try{"default"in e&&(fe=e.default)}catch(e){}var _e={};Object.defineProperty(_e,"__esModule",{value:true});_e.router=void 0;const he=fe;const ye=o;const pe=(0,ye.getCallBridge)();const navigate=e=>he.__awaiter(void 0,void 0,void 0,(function*(){return pe("navigate",{url:e,type:"same-tab"})}));const open=e=>he.__awaiter(void 0,void 0,void 0,(function*(){return pe("navigate",{url:e,type:"new-tab"})}));const reload=()=>he.__awaiter(void 0,void 0,void 0,(function*(){return pe("reload")}));_e.router={navigate:navigate,open:open,reload:reload};var be=e;try{"default"in e&&(be=e.default)}catch(e){}var ge={};Object.defineProperty(ge,"__esModule",{value:true});const we=be;we.__exportStar(_e,ge);var me=e;try{"default"in e&&(me=e.default)}catch(e){}var Oe={};Object.defineProperty(Oe,"__esModule",{value:true});Oe.Modal=void 0;const Pe=me;const Be=o;const je=t;const Me=(0,Be.getCallBridge)();const noop=()=>{};let Ce=class Modal{constructor(e){var t,o;this.resource=(e===null||e===void 0?void 0:e.resource)||null;this.onClose=(e===null||e===void 0?void 0:e.onClose)||noop;this.size=(e===null||e===void 0?void 0:e.size)||"medium";this.context=(e===null||e===void 0?void 0:e.context)||{};this.closeOnEscape=(t=e===null||e===void 0?void 0:e.closeOnEscape)===null||t===void 0||t;this.closeOnOverlayClick=(o=e===null||e===void 0?void 0:e.closeOnOverlayClick)===null||o===void 0||o}open(){return Pe.__awaiter(this,void 0,void 0,(function*(){try{const e=yield Me("openModal",{resource:this.resource,onClose:this.onClose,size:this.size,context:this.context,closeOnEscape:this.closeOnEscape,closeOnOverlayClick:this.closeOnOverlayClick});if(e===false)throw new je.BridgeAPIError("Unable to open modal.")}catch(e){throw new je.BridgeAPIError("Unable to open modal.")}}))}};Oe.Modal=Ce;var Ae=e;try{"default"in e&&(Ae=e.default)}catch(e){}var xe={};Object.defineProperty(xe,"__esModule",{value:true});const ke=Ae;ke.__exportStar(Oe,xe);var Ee={};Object.defineProperty(Ee,"__esModule",{value:true});Ee.blobToBase64=Ee.base64ToBlob=void 0;const base64ToBlob=(e,t)=>{if(!e)return null;const o=e.includes(";base64")?e.split(",")[1]:e;const r=atob(o);const n=new Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);const i=new Uint8Array(n);return new Blob([i],{type:t})};Ee.base64ToBlob=base64ToBlob;const blobToBase64=e=>new Promise(((t,o)=>{const r=new FileReader;r.onloadend=()=>{t(r.result)};r.onerror=o;r.readAsDataURL(e)}));Ee.blobToBase64=blobToBase64;var qe=e;try{"default"in e&&(qe=e.default)}catch(e){}var Ie={};Object.defineProperty(Ie,"__esModule",{value:true});Ie.productFetchApi=void 0;const Fe=qe;const Re=Ee;const parseFormData=e=>Fe.__awaiter(void 0,void 0,void 0,(function*(){const t={};for(const[o,r]of e.entries())if(o==="file"){const e=r.name;const o=r.type;t.file=yield(0,Re.blobToBase64)(r);t.__fileName=e;t.__fileType=o}else t[o]=r;return JSON.stringify(t)}));const parseRequest=e=>Fe.__awaiter(void 0,void 0,void 0,(function*(){const t=(e===null||e===void 0?void 0:e.body)instanceof FormData;const o=t?yield parseFormData(e===null||e===void 0?void 0:e.body):e===null||e===void 0?void 0:e.body;const r=new Request("",{body:o,method:e===null||e===void 0?void 0:e.method,headers:e===null||e===void 0?void 0:e.headers});const n=Object.fromEntries(r.headers.entries());const i=r.method!=="GET"?yield r.text():null;return{body:i,headers:new Headers(n),isMultipartFormData:t}}));const productFetchApi=e=>{const fetch=(t,o,r)=>Fe.__awaiter(void 0,void 0,void 0,(function*(){const{body:n,headers:i,isMultipartFormData:s}=yield parseRequest(r);i.has("X-Atlassian-Token")||i.set("X-Atlassian-Token","no-check");const a={product:t,restPath:o,fetchRequestInit:Object.assign(Object.assign({},r),{body:n,headers:[...i.entries()]}),isMultipartFormData:s};const{body:l,headers:c,statusText:d,status:u,isAttachment:v}=yield e("fetchProduct",a);const f=v?(0,Re.base64ToBlob)(l,c["content-type"]):l;return new Response(f||null,{headers:c,status:u,statusText:d})}));return{requestConfluence:(e,t)=>fetch("confluence",e,t),requestJira:(e,t)=>fetch("jira",e,t),requestBitbucket:(e,t)=>fetch("bitbucket",e,t)}};Ie.productFetchApi=productFetchApi;var Se={};var Te;Object.defineProperty(Se,"__esModule",{value:true});Se.requestBitbucket=Se.requestJira=Se.requestConfluence=void 0;const De=o;const He=Ie;Te=(0,He.productFetchApi)((0,De.getCallBridge)()),Se.requestConfluence=Te.requestConfluence,Se.requestJira=Te.requestJira,Se.requestBitbucket=Te.requestBitbucket;var Je=e;try{"default"in e&&(Je=e.default)}catch(e){}var Ue={};Object.defineProperty(Ue,"__esModule",{value:true});Ue.showFlag=void 0;const Le=Je;const ze=o;const Ke=t;const Ne=(0,ze.getCallBridge)();const showFlag$1=e=>{var t;if(!e.id)throw new Ke.BridgeAPIError('"id" must be defined in flag options');const o=Ne("showFlag",Object.assign(Object.assign({},e),{type:(t=e.type)!==null&&t!==void 0?t:"info"}));return{close:()=>Le.__awaiter(void 0,void 0,void 0,(function*(){yield o;return Ne("closeFlag",{id:e.id})}))}};Ue.showFlag=showFlag$1;var Xe={};Object.defineProperty(Xe,"__esModule",{value:true});Xe.showFlag=void 0;var Ge=Ue;Object.defineProperty(Xe,"showFlag",{enumerable:true,get:function(){return Ge.showFlag}});var Qe={};Object.defineProperty(Qe,"__esModule",{value:true});Qe.events=void 0;const Ve=o;const We=(0,Ve.getCallBridge)();const emit=(e,t)=>We("emit",{event:e,payload:t});const on=(e,t)=>We("on",{event:e,callback:t});Qe.events={emit:emit,on:on};var Ye=e;try{"default"in e&&(Ye=e.default)}catch(e){}var Ze={};Object.defineProperty(Ze,"__esModule",{value:true});const $e=Ye;$e.__exportStar(Qe,Ze);var et=e;try{"default"in e&&(et=e.default)}catch(e){}var tt={};Object.defineProperty(tt,"__esModule",{value:true});const ot=et;ot.__exportStar(_,tt);ot.__exportStar(M,tt);ot.__exportStar(ue,tt);ot.__exportStar(ge,tt);ot.__exportStar(xe,tt);ot.__exportStar(Se,tt);ot.__exportStar(Xe,tt);ot.__exportStar(Ze,tt);const rt=tt.__esModule,nt=tt.invoke,it=tt.invokeRemote,st=tt.view,at=tt.router,lt=tt.Modal,ct=tt.requestBitbucket,dt=tt.requestJira,ut=tt.requestConfluence,vt=tt.showFlag,ft=tt.events;export{lt as Modal,rt as __esModule,tt as default,ft as events,nt as invoke,it as invokeRemote,ct as requestBitbucket,ut as requestConfluence,dt as requestJira,at as router,vt as showFlag,st as view};
//# sourceMappingURL=index.js.map
